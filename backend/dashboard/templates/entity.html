<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - MMO Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/entity.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="breadcrumb">
                <a href="/">‚Üê Back to Main Dashboard</a>
            </div>
            <h1>üéÆ {{ page_title }}</h1>
            <div class="connection-controls">
                <span id="status" class="status {{ 'connected' if connection_status.connected else 'disconnected' }}">
                    {{ 'Connected' if connection_status.connected else 'Disconnected' }}
                </span>
                {% if not connection_status.connected %}
                <p style="color: #dc3545; margin: 10px 0;">
                    ‚ö†Ô∏è Not connected to server. <a href="/">Go to main dashboard</a> to connect first.
                </p>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <h4>Quick Actions</h4>
            <button type="button" class="btn spawn" id="quickSpawnBtn">Quick Spawn</button>
            <button type="button" class="btn despawn" id="quickDespawnBtn">Quick Despawn</button>
            <button type="button" class="btn secondary" onclick="EntityMgr.queryEntities()">Query All Entities</button>
            <button type="button" class="btn secondary" onclick="EntityMgr.getHealth()">Health Check</button>
        </div>
        
        <div class="entity-dashboard">
            <div class="entity-grid">
                <!-- Generated Forms Column -->
                <div class="entity-forms">
                    <!-- Spawn Entity Form -->
                    <div id="spawnFormContainer">
                        <!-- Form will be generated by JavaScript -->
                    </div>
                    
                    <!-- Update Entity Form -->
                    <div id="updateFormContainer">
                        <!-- Form will be generated by JavaScript -->
                    </div>
                    
                    <!-- Despawn Entity Form -->
                    <div id="despawnFormContainer">
                        <!-- Form will be generated by JavaScript -->
                    </div>
                </div>
                
                <!-- Entity Information Column -->
                <div class="entity-info">
                    <!-- Entity List/Status -->
                    <div class="entity-list">
                        <h3>Entity Information</h3>
                        <p class="info-text">
                            Entities will appear here when they are spawned or queried from the server.
                            Use the message log below to see entity operations.
                        </p>
                        
                        <div class="entity-actions">
                            <h4>Preset Actions</h4>
                            <button type="button" class="btn small" onclick="EntityMgr.addPredefinedStats('spawnEntityForm', 'warrior')">
                                Add Warrior Stats
                            </button>
                            <button type="button" class="btn small" onclick="EntityMgr.addPredefinedStats('spawnEntityForm', 'mage')">
                                Add Mage Stats
                            </button>
                            <button type="button" class="btn small" onclick="EntityMgr.addPredefinedStats('spawnEntityForm', 'default')">
                                Add Default Stats
                            </button>
                        </div>
                        
                        <div class="schema-info">
                            <h4>Available Message Types</h4>
                            {% if schemas %}
                                <p>Loaded {{ schemas|length }} schema(s) with the following entity message types:</p>
                                <ul>
                                    <li>SpawnEntityMessage - Create new entities</li>
                                    <li>EntityUpdateMessage - Modify existing entities</li>
                                    <li>EntityDespawnMessage - Remove entities</li>
                                    <li>EntityDataMessage - Entity data structure</li>
                                </ul>
                            {% else %}
                                <p style="color: #dc3545;">
                                    ‚ö†Ô∏è No schemas loaded. Make sure protobuf schemas are generated and available.
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Message Log -->
        <div class="panel">
            <div class="panel-header">
                üìù Entity Operations Log
                <div>
                    <button class="btn small" onclick="Util.refreshMessages()">Refresh</button>
                    <button class="btn small" onclick="Util.clearMessages()">Clear</button>
                </div>
            </div>
            <div class="panel-content">
                <div id="messageLog" class="message-log"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/entity.js') }}"></script>
    <script>
        // Pass schemas to JavaScript
        const loadedSchemas = {{ schemas | tojson }};
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing entity dashboard with schemas:', loadedSchemas);
        });
    </script>
</body>
</html>
